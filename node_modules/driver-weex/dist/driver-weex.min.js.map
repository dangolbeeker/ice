{"version":3,"file":"driver-weex.min.js","sources":["../../style-unit/node_modules/universal-env/lib/index.js","../../style-unit/lib/index.js","../src/index.js"],"sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\nexports.isQuickApp = exports.isWeChatMiniProgram = exports.isByteDanceMicroApp = exports.isMiniApp = exports.isKraken = exports.isWeex = exports.isNode = exports.isWeb = void 0;\n\nfunction isUndef(type) {\n  return type === 'undefined';\n}\n\nvar isWeb = !isUndef(typeof window) && 'onload' in window;\nexports.isWeb = isWeb;\nvar isNode = !isUndef(typeof process) && !!(process.versions && process.versions.node);\nexports.isNode = isNode;\nvar isWeex = !isUndef(typeof WXEnvironment) && WXEnvironment.platform !== 'Web';\nexports.isWeex = isWeex;\nvar isKraken = !isUndef(typeof __kraken__);\nexports.isKraken = isKraken;\nvar isMiniApp = !isUndef(typeof my) && my !== null && !isUndef(typeof my.alert);\nexports.isMiniApp = isMiniApp;\nvar isByteDanceMicroApp = !isUndef(typeof tt) && tt !== null && !isUndef(typeof tt) && !isUndef(tt.showToast); // In wechat mini program, wx.login is a function\n// In wechat mini propgram webview, there is no wx.login, but exist wx.miniProgram\n// In bytedance maicro app, there is wx variable.\n\nexports.isByteDanceMicroApp = isByteDanceMicroApp;\nvar isWeChatMiniProgram = !isByteDanceMicroApp && !isUndef(typeof wx) && wx !== null && (!isUndef(typeof wx.login) || !isUndef(typeof wx.miniProgram));\nexports.isWeChatMiniProgram = isWeChatMiniProgram;\nvar isQuickApp = !isUndef(typeof global) && global !== null && !isUndef(typeof global.callNative) && !isWeex;\nexports.isQuickApp = isQuickApp;","\"use strict\";\n\nexports.__esModule = true;\nexports.isRpx = isRpx;\nexports.calcRpx = calcRpx;\nexports.getRpx = getRpx;\nexports.setRpx = setRpx;\nexports.getViewportWidth = getViewportWidth;\nexports.setViewportWidth = setViewportWidth;\nexports.setDecimalPixelTransformer = setDecimalPixelTransformer;\nexports.setUnitPrecision = setUnitPrecision;\nexports.cached = cached;\nexports.setTargetPlatform = setTargetPlatform;\nexports.convertUnit = void 0;\n\nvar _universalEnv = require(\"universal-env\");\n\nvar RPX_REG = /\"[^\"]+\"|'[^']+'|url\\([^\\)]+\\)|(\\d*\\.?\\d+)rpx/g;\n\nvar __rpx_coefficient__;\n\nvar __viewport_width__; // convertUnit method targetPlatform\n\n\nvar targetPlatform = _universalEnv.isWeb ? 'web' : _universalEnv.isWeex ? 'weex' : ''; // Init toFixed method\n\nvar unitPrecision = 4;\n\nvar toFixed = function toFixed(number, precision) {\n  var multiplier = Math.pow(10, precision + 1);\n  var wholeNumber = Math.floor(number * multiplier);\n  return Math.round(wholeNumber / 10) * 10 / multiplier;\n}; // Dedault decimal px transformer.\n\n\nvar decimalPixelTransformer = function decimalPixelTransformer(rpx, $1) {\n  return $1 ? parseFloat(rpx) * getRpx() + 'px' : rpx;\n}; // Default decimal vw transformer.\n\n\nvar decimalVWTransformer = function decimalVWTransformer(rpx, $1) {\n  return $1 ? toFixed(parseFloat(rpx) / (getViewportWidth() / 100), unitPrecision) + 'vw' : rpx;\n}; // Default 1 rpx to 1 px\n\n\nif (getRpx() === undefined) {\n  setRpx(1);\n} // Viewport width, default to 750.\n\n\nif (getViewportWidth() === undefined) {\n  setViewportWidth(750);\n}\n/**\n * Is string contains rpx\n * note: rpx is an alias to rpx\n * @param {String} str\n * @returns {Boolean}\n */\n\n\nfunction isRpx(str) {\n  return typeof str === 'string' && RPX_REG.test(str);\n}\n/**\n * Calculate rpx\n * @param {String} str\n * @returns {String}\n */\n\n\nfunction calcRpx(str) {\n  if (targetPlatform === 'web') {\n    // In Web convert rpx to 'vw', same as driver-dom and driver-universal\n    // '375rpx' => '50vw'\n    return str.replace(RPX_REG, decimalVWTransformer);\n  } else if (targetPlatform === 'weex') {\n    // In Weex convert rpx to 'px'\n    // '375rpx' => 375 * px\n    return str.replace(RPX_REG, decimalPixelTransformer);\n  } else {\n    // Other platform return original value, like Mini-App and WX Mini-Program ...\n    // '375rpx' => '375rpx'\n    return str;\n  }\n}\n\nfunction getRpx() {\n  return __rpx_coefficient__;\n}\n\nfunction setRpx(rpx) {\n  __rpx_coefficient__ = rpx;\n}\n\nfunction getViewportWidth() {\n  return __viewport_width__;\n}\n\nfunction setViewportWidth(viewport) {\n  __viewport_width__ = viewport;\n}\n/**\n * Set a function to transform unit of pixel,\n * default to passthrough.\n * @param {Function} transformer function\n */\n\n\nfunction setDecimalPixelTransformer(transformer) {\n  decimalPixelTransformer = transformer;\n}\n/**\n * Set unit precision.\n * @param n {Number} Unit precision, default to 4.\n */\n\n\nfunction setUnitPrecision(n) {\n  unitPrecision = n;\n}\n/**\n * Create a cached version of a pure function.\n * Use the first params as cache key.\n */\n\n\nfunction cached(fn) {\n  var cache = new Map();\n  return function cachedFn() {\n    var key = arguments.length <= 0 ? undefined : arguments[0];\n    if (!cache.has(key)) cache.set(key, fn.apply(void 0, arguments));\n    return cache.get(key);\n  };\n}\n\nfunction setTargetPlatform(platform) {\n  targetPlatform = platform;\n}\n/**\n * Convert rpx.\n * @param value\n * @param prop\n * @param platform\n * @return {String} Transformed value.\n */\n\n\nvar convertUnit = cached(function (value, prop, platform) {\n  if (platform) {\n    setTargetPlatform(platform);\n  }\n\n  return isRpx(value) ? calcRpx(value) : value;\n});\nexports.convertUnit = convertUnit;","import { setRpx, convertUnit } from 'style-unit';\n\nconst STYLE = 'style';\nconst ID = 'id';\nconst TEXT = 'text';\nconst CHILDREN = 'children';\nconst EVENT_PREFIX_REGEXP = /^on[A-Z]/;\nconst ARIA_PREFIX_REGEXP = /^aria-/;\nconst HYPHEN_REGEXP = /\\-(\\w)/;\nconst EMPTY = '';\n\nfunction updateWeexTextValue(node) {\n  const value = node.children.map(function(child) {\n    // Comment node type\n    return child.nodeType === 8 ? child.value : EMPTY;\n  }).join(EMPTY);\n\n  node.setAttr('value', value);\n}\n\nconst nodeMaps = {};\n/* global __weex_document__ */\nconst document = typeof __weex_document__ === 'object' ?\n  __weex_document__ : typeof document === 'object' ?\n    document : null;\n\nexport function getElementById(id) {\n  return nodeMaps[id];\n}\n\nexport function createBody(type, props) {\n  if (document.body) {\n    return document.body;\n  }\n\n  const documentElement = document.documentElement;\n  const body = document.createBody(type, props);\n  documentElement.appendChild(body);\n\n  return body;\n}\n\nexport function createComment(content) {\n  return document.createComment(content);\n}\n\nexport function createEmpty() {\n  return createComment(EMPTY);\n}\n\nexport function createText(text) {\n  // Use comment node type mock text node\n  return createComment(text);\n}\n\nexport function updateText(node, text) {\n  node.value = text;\n  updateWeexTextValue(node.parentNode);\n}\n\nexport function createElement(type, props = {}) {\n  const style = {};\n  const originStyle = props.style;\n  if (originStyle) {\n    for (let prop in originStyle) {\n      style[prop] = convertUnit(originStyle[prop], prop);\n    }\n  }\n\n  const node = document.createElement(type, {\n    style\n  });\n\n  for (let prop in props) {\n    let value = props[prop];\n    if (prop === CHILDREN) {\n      continue;\n    }\n    if (value != null) {\n      if (prop === STYLE) {\n        continue;\n      } else if (EVENT_PREFIX_REGEXP.test(prop)) {\n        let eventName = prop.slice(2).toLowerCase();\n        addEventListener(node, eventName, value, props);\n      } else {\n        setAttribute(node, prop, value);\n      }\n    }\n  }\n\n  return node;\n}\n\nexport function appendChild(node, parent) {\n  parent.appendChild(node);\n\n  if (parent.type === TEXT) {\n    updateWeexTextValue(parent);\n  }\n}\n\nexport function removeChild(node, parent) {\n  parent = parent || node.parentNode;\n  let id = node.attr && node.attr[ID];\n  if (id != null) {\n    nodeMaps[id] = null;\n  }\n\n  parent.removeChild(node);\n\n  if (parent.type === TEXT) {\n    updateWeexTextValue(parent);\n  }\n}\n\nexport function replaceChild(newChild, oldChild, parent) {\n  parent = parent || oldChild.parentNode;\n  let previousSibling = oldChild.previousSibling;\n  let nextSibling = oldChild.nextSibling;\n  removeChild(oldChild, parent);\n\n  if (previousSibling) {\n    insertAfter(newChild, previousSibling, parent);\n  } else if (nextSibling) {\n    insertBefore(newChild, nextSibling, parent);\n  } else {\n    appendChild(newChild, parent);\n  }\n}\n\nexport function insertAfter(node, after, parent) {\n  parent = parent || after.parentNode;\n  parent.insertAfter(node, after);\n\n  if (parent.type === TEXT) {\n    updateWeexTextValue(parent);\n  }\n}\n\nexport function insertBefore(node, before, parent) {\n  parent = parent || before.parentNode;\n  parent.insertBefore(node, before);\n\n  if (parent.type === TEXT) {\n    updateWeexTextValue(parent);\n  }\n}\n\nexport function addEventListener(node, eventName, eventHandler, props) {\n  // https://github.com/apache/incubator-weex/blob/master/runtime/vdom/Element.js#L421\n  let params = props[eventName + 'EventParams'];\n  return node.addEvent(eventName, eventHandler, params);\n}\n\nexport function removeEventListener(node, eventName, eventHandler) {\n  return node.removeEvent(eventName, eventHandler);\n}\n\nexport function removeAttribute(node, propKey, propValue) {\n  if (propKey == ID) {\n    nodeMaps[propValue] = null;\n  }\n  // Weex native will crash when pass null value\n  return node.setAttr(propKey, undefined, false);\n}\n\nexport function setAttribute(node, propKey, propValue) {\n  if (propKey == ID) {\n    nodeMaps[propValue] = node;\n  }\n\n  // Weex only support `ariaLabel` format, convert `aria-label` format to camelcase\n  if (ARIA_PREFIX_REGEXP.test(propKey)) {\n    propKey = propKey.replace(HYPHEN_REGEXP, function(m, p) {\n      return p.toUpperCase();\n    });\n  }\n\n  return node.setAttr(propKey, propValue, false);\n}\n\nexport function setStyle(node, style) {\n  for (let prop in style) {\n    // Translate `rpx` to weex `px`\n    style[prop] = convertUnit(style[prop], prop);\n  }\n  node.setStyles(style);\n}\n\nexport function beforeRender() {\n  // Turn off batched updates\n  document.open();\n\n  // Set `rpx` unit converter\n  setRpx(1);\n}\n\nexport function afterRender() {\n  if (document.listener && document.listener.createFinish) {\n    document.listener.createFinish();\n  }\n\n  // Turn on batched updates\n  document.close();\n}\n"],"names":["isUndef","type","exports","isWeb","window","isNode","process","versions","node","isWeex","WXEnvironment","platform","isKraken","__kraken__","isMiniApp","my","alert","isByteDanceMicroApp","tt","showToast","isWeChatMiniProgram","wx","login","miniProgram","isQuickApp","global","callNative","isRpx","calcRpx","getRpx","setRpx","getViewportWidth","setViewportWidth","transformer","decimalPixelTransformer","n","unitPrecision","cached","setTargetPlatform","__rpx_coefficient__","__viewport_width__","RPX_REG","targetPlatform","_universalEnv","rpx","$1","parseFloat","decimalVWTransformer","number","Math","round","floor","multiplier","pow","str","test","replace","viewport","fn","cache","Map","key","arguments","length","undefined","has","set","apply","get","convertUnit","value","prop","ID","TEXT","EVENT_PREFIX_REGEXP","ARIA_PREFIX_REGEXP","HYPHEN_REGEXP","updateWeexTextValue","children","map","child","nodeType","join","setAttr","nodeMaps","document","__weex_document__","createComment","content","appendChild","parent","removeChild","parentNode","id","attr","insertAfter","after","insertBefore","before","addEventListener","eventName","eventHandler","props","addEvent","setAttribute","propKey","propValue","m","p","toUpperCase","listener","createFinish","close","open","body","documentElement","createBody","style","originStyle","createElement","slice","toLowerCase","text","removeEvent","newChild","oldChild","previousSibling","nextSibling","setStyles"],"mappings":"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"}