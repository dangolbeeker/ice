{"version":3,"file":"driver-kraken.min.js","sources":["../../style-unit/node_modules/universal-env/lib/index.js","../../style-unit/lib/index.js","../src/index.js"],"sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\nexports.isQuickApp = exports.isWeChatMiniProgram = exports.isByteDanceMicroApp = exports.isMiniApp = exports.isKraken = exports.isWeex = exports.isNode = exports.isWeb = void 0;\n\nfunction isUndef(type) {\n  return type === 'undefined';\n}\n\nvar isWeb = !isUndef(typeof window) && 'onload' in window;\nexports.isWeb = isWeb;\nvar isNode = !isUndef(typeof process) && !!(process.versions && process.versions.node);\nexports.isNode = isNode;\nvar isWeex = !isUndef(typeof WXEnvironment) && WXEnvironment.platform !== 'Web';\nexports.isWeex = isWeex;\nvar isKraken = !isUndef(typeof __kraken__);\nexports.isKraken = isKraken;\nvar isMiniApp = !isUndef(typeof my) && my !== null && !isUndef(typeof my.alert);\nexports.isMiniApp = isMiniApp;\nvar isByteDanceMicroApp = !isUndef(typeof tt) && tt !== null && !isUndef(typeof tt) && !isUndef(tt.showToast); // In wechat mini program, wx.login is a function\n// In wechat mini propgram webview, there is no wx.login, but exist wx.miniProgram\n// In bytedance maicro app, there is wx variable.\n\nexports.isByteDanceMicroApp = isByteDanceMicroApp;\nvar isWeChatMiniProgram = !isByteDanceMicroApp && !isUndef(typeof wx) && wx !== null && (!isUndef(typeof wx.login) || !isUndef(typeof wx.miniProgram));\nexports.isWeChatMiniProgram = isWeChatMiniProgram;\nvar isQuickApp = !isUndef(typeof global) && global !== null && !isUndef(typeof global.callNative) && !isWeex;\nexports.isQuickApp = isQuickApp;","\"use strict\";\n\nexports.__esModule = true;\nexports.isRpx = isRpx;\nexports.calcRpx = calcRpx;\nexports.getRpx = getRpx;\nexports.setRpx = setRpx;\nexports.getViewportWidth = getViewportWidth;\nexports.setViewportWidth = setViewportWidth;\nexports.setDecimalPixelTransformer = setDecimalPixelTransformer;\nexports.setUnitPrecision = setUnitPrecision;\nexports.cached = cached;\nexports.setTargetPlatform = setTargetPlatform;\nexports.convertUnit = void 0;\n\nvar _universalEnv = require(\"universal-env\");\n\nvar RPX_REG = /\"[^\"]+\"|'[^']+'|url\\([^\\)]+\\)|(\\d*\\.?\\d+)rpx/g;\n\nvar __rpx_coefficient__;\n\nvar __viewport_width__; // convertUnit method targetPlatform\n\n\nvar targetPlatform = _universalEnv.isWeb ? 'web' : _universalEnv.isWeex ? 'weex' : ''; // Init toFixed method\n\nvar unitPrecision = 4;\n\nvar toFixed = function toFixed(number, precision) {\n  var multiplier = Math.pow(10, precision + 1);\n  var wholeNumber = Math.floor(number * multiplier);\n  return Math.round(wholeNumber / 10) * 10 / multiplier;\n}; // Dedault decimal px transformer.\n\n\nvar decimalPixelTransformer = function decimalPixelTransformer(rpx, $1) {\n  return $1 ? parseFloat(rpx) * getRpx() + 'px' : rpx;\n}; // Default decimal vw transformer.\n\n\nvar decimalVWTransformer = function decimalVWTransformer(rpx, $1) {\n  return $1 ? toFixed(parseFloat(rpx) / (getViewportWidth() / 100), unitPrecision) + 'vw' : rpx;\n}; // Default 1 rpx to 1 px\n\n\nif (getRpx() === undefined) {\n  setRpx(1);\n} // Viewport width, default to 750.\n\n\nif (getViewportWidth() === undefined) {\n  setViewportWidth(750);\n}\n/**\n * Is string contains rpx\n * note: rpx is an alias to rpx\n * @param {String} str\n * @returns {Boolean}\n */\n\n\nfunction isRpx(str) {\n  return typeof str === 'string' && RPX_REG.test(str);\n}\n/**\n * Calculate rpx\n * @param {String} str\n * @returns {String}\n */\n\n\nfunction calcRpx(str) {\n  if (targetPlatform === 'web') {\n    // In Web convert rpx to 'vw', same as driver-dom and driver-universal\n    // '375rpx' => '50vw'\n    return str.replace(RPX_REG, decimalVWTransformer);\n  } else if (targetPlatform === 'weex') {\n    // In Weex convert rpx to 'px'\n    // '375rpx' => 375 * px\n    return str.replace(RPX_REG, decimalPixelTransformer);\n  } else {\n    // Other platform return original value, like Mini-App and WX Mini-Program ...\n    // '375rpx' => '375rpx'\n    return str;\n  }\n}\n\nfunction getRpx() {\n  return __rpx_coefficient__;\n}\n\nfunction setRpx(rpx) {\n  __rpx_coefficient__ = rpx;\n}\n\nfunction getViewportWidth() {\n  return __viewport_width__;\n}\n\nfunction setViewportWidth(viewport) {\n  __viewport_width__ = viewport;\n}\n/**\n * Set a function to transform unit of pixel,\n * default to passthrough.\n * @param {Function} transformer function\n */\n\n\nfunction setDecimalPixelTransformer(transformer) {\n  decimalPixelTransformer = transformer;\n}\n/**\n * Set unit precision.\n * @param n {Number} Unit precision, default to 4.\n */\n\n\nfunction setUnitPrecision(n) {\n  unitPrecision = n;\n}\n/**\n * Create a cached version of a pure function.\n * Use the first params as cache key.\n */\n\n\nfunction cached(fn) {\n  var cache = new Map();\n  return function cachedFn() {\n    var key = arguments.length <= 0 ? undefined : arguments[0];\n    if (!cache.has(key)) cache.set(key, fn.apply(void 0, arguments));\n    return cache.get(key);\n  };\n}\n\nfunction setTargetPlatform(platform) {\n  targetPlatform = platform;\n}\n/**\n * Convert rpx.\n * @param value\n * @param prop\n * @param platform\n * @return {String} Transformed value.\n */\n\n\nvar convertUnit = cached(function (value, prop, platform) {\n  if (platform) {\n    setTargetPlatform(platform);\n  }\n\n  return isRpx(value) ? calcRpx(value) : value;\n});\nexports.convertUnit = convertUnit;","/**\n * Driver for Kraken\n **/\nimport { convertUnit, cached } from 'style-unit';\n\nconst NON_DIMENSIONAL_REG = /opa|ntw|ne[ch]|ex(?:s|g|n|p|$)|^ord|zoo|grid|orp|ows|mnc|^columns$|bs|erim|onit/i;\nconst EVENT_PREFIX_REG = /^on[A-Z]/;\nconst DANGEROUSLY_SET_INNER_HTML = 'dangerouslySetInnerHTML';\nconst CLASS_NAME = 'className';\nconst CLASS = 'class';\nconst STYLE = 'style';\nconst CHILDREN = 'children';\nconst TEXT_CONTENT_ATTR = 'textContent';\nconst CREATE_ELEMENT = 'createElement';\nconst CREATE_COMMENT = 'createComment';\nconst CREATE_TEXT_NODE = 'createTextNode';\nconst SET_ATTRIBUTE = 'setAttribute';\nconst REMOVE_ATTRIBUTE = 'removeAttribute';\nconst EMPTY = '';\n\nconst isEventProp = cached(prop => EVENT_PREFIX_REG.test(prop));\n\nexport function createBody() {\n  return document.body;\n}\n\nexport function createEmpty(component) {\n  return document[CREATE_COMMENT](EMPTY);\n}\n\nexport function createText(text, component) {\n  return document[CREATE_TEXT_NODE](text);\n}\n\nexport function updateText(node, text) {\n  node[TEXT_CONTENT_ATTR] = text;\n}\n\nexport function createElement(type, props, component, __shouldConvertUnitlessToRpx) {\n  const node = document[CREATE_ELEMENT](type);\n\n  for (let prop in props) {\n    const value = props[prop];\n    if (prop === CHILDREN) continue;\n\n    if (value != null) {\n      if (prop === STYLE) {\n        setStyle(node, value, __shouldConvertUnitlessToRpx);\n      } else if (isEventProp(prop)) {\n        addEventListener(node, prop.slice(2).toLowerCase(), value, component);\n      } else {\n        setAttribute(node, prop, value);\n      }\n    }\n  }\n\n  return node;\n}\n\nexport function appendChild(node, parent) {\n  return parent.appendChild(node);\n}\n\nexport function removeChild(node, parent) {\n  parent = parent || node.parentNode;\n  // Maybe has been removed when remove child\n  if (parent) {\n    parent.removeChild(node);\n  }\n}\n\nexport function replaceChild(newChild, oldChild, parent) {\n  parent = parent || oldChild.parentNode;\n  parent.replaceChild(newChild, oldChild);\n}\n\nexport function insertAfter(node, after, parent) {\n  parent = parent || after.parentNode;\n  const nextSibling = after.nextSibling;\n  if (nextSibling) {\n    // Performance improve when node has been existed before nextSibling\n    if (nextSibling !== node) {\n      insertBefore(node, nextSibling, parent);\n    }\n  } else {\n    appendChild(node, parent);\n  }\n}\n\nexport function insertBefore(node, before, parent) {\n  parent = parent || before.parentNode;\n  parent.insertBefore(node, before);\n}\n\nexport function addEventListener(node, eventName, eventHandler) {\n  return node.addEventListener(eventName, eventHandler);\n}\n\nexport function removeEventListener(node, eventName, eventHandler) {\n  return node.removeEventListener(eventName, eventHandler);\n}\n\nexport function removeAttribute(node, propKey) {\n  if (propKey === DANGEROUSLY_SET_INNER_HTML) return;\n\n  if (propKey === CLASS_NAME) propKey = CLASS;\n\n  if (propKey in node) {\n    try {\n      // Some node property is readonly when in strict mode\n      node[propKey] = null;\n    } catch (e) { }\n  }\n\n  node[REMOVE_ATTRIBUTE](propKey);\n}\n\nexport function setAttribute(node, propKey, propValue) {\n  // For reduce innerHTML operation to improve performance.\n  if (propKey === DANGEROUSLY_SET_INNER_HTML) {\n    warnUnsupport(DANGEROUSLY_SET_INNER_HTML);\n    return;\n  }\n\n  if (propKey === CLASS_NAME) propKey = CLASS;\n\n  if (propKey in node) {\n    try {\n      // Some node property is readonly when in strict mode\n      node[propKey] = propValue;\n    } catch (e) {\n      node[SET_ATTRIBUTE](propKey, propValue);\n    }\n  } else {\n    node[SET_ATTRIBUTE](propKey, propValue);\n  }\n}\n\nconst isDimensionalProp = cached(prop => !NON_DIMENSIONAL_REG.test(prop));\n\nexport function setStyle(node, style, __shouldConvertUnitlessToRpx) {\n  for (let prop in style) {\n    const value = style[prop];\n    let convertedValue;\n    if (typeof value === 'number' && isDimensionalProp(prop)) {\n      if (__shouldConvertUnitlessToRpx) {\n        convertedValue = value + 'rpx';\n        // Transfrom rpx to vw\n        convertedValue = convertUnit(convertedValue, prop);\n      } else {\n        convertedValue = value + 'px';\n      }\n    } else {\n      convertedValue = convertUnit(value, prop);\n    }\n\n    // Support CSS custom properties (variables) like { --main-color: \"black\" }\n    if (prop[0] === '-' && prop[1] === '-') {\n      // reference: https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleDeclaration/setProperty.\n      // style.setProperty do not support Camel-Case style properties.\n      node.style.setProperty(prop, convertedValue);\n    } else {\n      node.style[prop] = convertedValue;\n    }\n  }\n}\n\nfunction warnUnsupport(message) {\n  console.warn(`[DriverKraken]: ${message} is not supported.`);\n}\n"],"names":["isUndef","type","exports","isWeb","window","isNode","process","versions","node","isWeex","WXEnvironment","platform","isKraken","__kraken__","isMiniApp","my","alert","isByteDanceMicroApp","tt","showToast","isWeChatMiniProgram","wx","login","miniProgram","isQuickApp","global","callNative","isRpx","calcRpx","getRpx","setRpx","getViewportWidth","setViewportWidth","transformer","decimalPixelTransformer","n","unitPrecision","cached","setTargetPlatform","__rpx_coefficient__","__viewport_width__","RPX_REG","targetPlatform","_universalEnv","rpx","$1","parseFloat","decimalVWTransformer","number","Math","round","floor","multiplier","pow","str","test","replace","viewport","fn","cache","Map","key","arguments","length","undefined","has","set","apply","get","convertUnit","value","prop","NON_DIMENSIONAL_REG","EVENT_PREFIX_REG","DANGEROUSLY_SET_INNER_HTML","CLASS_NAME","CLASS","isEventProp","appendChild","parent","insertBefore","before","parentNode","addEventListener","eventName","eventHandler","setAttribute","propKey","propValue","e","console","warn","isDimensionalProp","setStyle","style","__shouldConvertUnitlessToRpx","convertedValue","setProperty","document","body","props","component","slice","toLowerCase","text","after","nextSibling","removeChild","removeEventListener","newChild","oldChild","replaceChild"],"mappings":"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"}