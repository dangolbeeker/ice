"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var path = require("path");
var globby = require("globby");
var app_helpers_1 = require("@builder/app-helpers");
var getRaxRenderData_1 = require("./getRaxRenderData");
function generateEntry(api, options) {
    var rootDir = api.context.rootDir;
    var framework = options.framework, targetDir = options.targetDir, pageEntry = options.pageEntry, entryName = options.entryName;
    var entryFolder = path.join(targetDir, 'mpaEntry');
    var entryPath = path.join(entryFolder, entryName + ".tsx");
    var templatePath = path.join(__dirname, "../template/" + framework + ".ts.ejs");
    var globalStyles = globby.sync(['src/global.@(scss|less|css)'], { cwd: rootDir });
    var renderData = {
        globalStyle: globalStyles.length && app_helpers_1.formatPath(path.join(rootDir, globalStyles[0])),
        resourcePath: "" + app_helpers_1.formatPath(path.extname(pageEntry) ? pageEntry.split('.').slice(0, -1).join('.') : pageEntry),
    };
    api.applyMethod('addRenderFile', templatePath, entryPath, framework === 'rax' ? getRaxRenderData_1.default(api, renderData, options) : renderData);
    return entryPath;
}
exports.default = generateEntry;
