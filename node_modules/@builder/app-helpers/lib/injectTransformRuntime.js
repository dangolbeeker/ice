"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var formatPath_1 = require("./formatPath");
function default_1(config) {
    ['jsx', 'tsx'].forEach(function (rule) {
        config.module
            .rule(rule)
            .use('babel-loader')
            .tap(function (options) {
            // get @babel/plugin-transform-runtime
            var babelPlugins = options.plugins || [];
            var targetPlugin = formatPath_1.default('@babel/plugin-transform-runtime');
            var pluginOptions = {
                corejs: false,
                helpers: false,
                regenerator: true,
                useESModules: false,
            };
            var addedTransformPlugin;
            var plugins = babelPlugins.map(function (plugin) {
                if (typeof plugin === 'string' && formatPath_1.default(plugin).indexOf(targetPlugin) > -1
                    || Array.isArray(plugin) && formatPath_1.default(plugin[0]).indexOf(targetPlugin) > -1) {
                    addedTransformPlugin = true;
                    return [Array.isArray(plugin) ? plugin[0] : plugin, pluginOptions];
                }
                return plugin;
            });
            if (!addedTransformPlugin) {
                plugins.push([require.resolve('@babel/plugin-transform-runtime'), pluginOptions]);
            }
            return Object.assign(options, { plugins: plugins });
        });
    });
}
exports.default = default_1;
