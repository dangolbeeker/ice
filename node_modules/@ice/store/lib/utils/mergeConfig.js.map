{"version":3,"file":"mergeConfig.js","sourceRoot":"","sources":["../../src/utils/mergeConfig.ts"],"names":[],"mappings":"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","sourcesContent":["import * as T from '../types';\nimport validate from './validate';\n\nconst merge = (original: any, next: any): any => {\n  return next ? { ...next, ...(original || {}) } : original || {};\n};\n\nconst isObject = (obj: object): boolean =>\n  Array.isArray(obj) || typeof obj !== 'object';\n\n/**\n * mergeConfig\n *\n * merge init configs together\n */\nexport default (initConfig: T.InitConfig & { name: string }): T.Config => {\n  const config: T.Config = {\n    name: initConfig.name,\n    models: {},\n    plugins: [],\n    ...initConfig,\n    redux: {\n      reducers: {},\n      rootReducers: {},\n      enhancers: [],\n      middlewares: [],\n      ...initConfig.redux,\n      devtoolOptions: {\n        name: initConfig.name,\n        ...(initConfig.redux && initConfig.redux.devtoolOptions\n          ? initConfig.redux.devtoolOptions\n          : {}),\n      },\n    },\n  };\n\n  if (process.env.NODE_ENV !== 'production') {\n    validate([\n      [!Array.isArray(config.plugins), 'init config.plugins must be an array'],\n      [isObject(config.models), 'init config.models must be an object'],\n      [\n        isObject(config.redux.reducers),\n        'init config.redux.reducers must be an object',\n      ],\n      [\n        !Array.isArray(config.redux.middlewares),\n        'init config.redux.middlewares must be an array',\n      ],\n      [\n        !Array.isArray(config.redux.enhancers),\n        'init config.redux.enhancers must be an array of functions',\n      ],\n      [\n        config.redux.combineReducers &&\n\t\t\t\t\ttypeof config.redux.combineReducers !== 'function',\n        'init config.redux.combineReducers must be a function',\n      ],\n      [\n        config.redux.createStore &&\n\t\t\t\t\ttypeof config.redux.createStore !== 'function',\n        'init config.redux.createStore must be a function',\n      ],\n    ]);\n  }\n\n  // defaults\n  for (const plugin of config.plugins) {\n    if (plugin.config) {\n      // models\n      const models: T.Models = merge(config.models, plugin.config.models);\n      config.models = models;\n\n      // plugins\n      config.plugins = [...config.plugins, ...(plugin.config.plugins || [])];\n\n      // redux\n      if (plugin.config.redux) {\n        config.redux.initialStates = merge(\n          config.redux.initialStates,\n          plugin.config.redux.initialStates,\n        );\n        config.redux.reducers = merge(\n          config.redux.reducers,\n          plugin.config.redux.reducers,\n        );\n        config.redux.rootReducers = merge(\n          config.redux.rootReducers,\n          plugin.config.redux.reducers,\n        );\n        config.redux.enhancers = [\n          ...config.redux.enhancers,\n          ...(plugin.config.redux.enhancers || []),\n        ];\n        config.redux.middlewares = [\n          ...config.redux.middlewares,\n          ...(plugin.config.redux.middlewares || []),\n        ];\n        config.redux.combineReducers =\n          config.redux.combineReducers || plugin.config.redux.combineReducers;\n        config.redux.createStore =\n          config.redux.createStore || plugin.config.redux.createStore;\n      }\n    }\n  }\n  return config;\n};\n"]}