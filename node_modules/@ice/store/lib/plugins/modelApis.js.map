{"version":3,"file":"modelApis.js","sourceRoot":"","sources":["../../src/plugins/modelApis.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\nimport * as T from '../types';\nimport warning from '../utils/warning';\n\nlet warnedUseModelActions = false;\nlet warnedWithModelActions = false;\nlet warnedUseModelActionsState = false;\nlet warnedWithModelActionsState = false;\n\n\n/**\n * ModelApis Plugin\n *\n * generates hooks for store\n */\nexport default (): T.Plugin => {\n  return {\n    onStoreCreated(store: any) {\n      // hooks\n      function useModel(name) {\n        const state = useModelState(name);\n        const dispatchers = useModelDispatchers(name);\n        return [state, dispatchers];\n      }\n      function useModelState(name) {\n        const selector = store.useSelector(state => state[name]);\n        if (typeof selector !== \"undefined\") {\n          return selector;\n        }\n        throw new Error(`Not found model by namespace: ${name}.`);\n      }\n      function useModelDispatchers(name) {\n        const dispatch = store.useDispatch();\n        if (dispatch[name]) {\n          return dispatch[name];\n        }\n        throw new Error(`Not found model by namespace: ${name}.`);\n      }\n      function useModelEffectsState(name) {\n        const dispatch = useModelDispatchers(name);\n        const effectsLoading = useModelEffectsLoading(name);\n        const effectsError = useModelEffectsError(name);\n\n        const states = {};\n        Object.keys(dispatch).forEach(key => {\n          states[key] = {\n            isLoading: effectsLoading[key],\n            error: effectsError[key] ? effectsError[key].error : null,\n          };\n        });\n        return states;\n      }\n      function useModelEffectsError(name) {\n        return store.useSelector(state => state.error ? state.error.effects[name] : undefined);\n      }\n      function useModelEffectsLoading(name) {\n        return store.useSelector(state => state.loading ? state.loading.effects[name] : undefined);\n      }\n\n      /**\n       * @deprecated use `useModelEffectsState` instead\n       */\n      function useModelActionsState(name) {\n        if (!warnedUseModelActionsState) {\n          warnedUseModelActionsState = true;\n          warning('`useModelActionsState` API has been detected, please use `useModelEffectsState` instead. \\n\\n\\n Visit https://github.com/ice-lab/icestore/blob/master/docs/upgrade-guidelines.md#usemodelactionsstate to learn about how to upgrade.');\n        }\n        return useModelEffectsState(name);\n      }\n\n      /**\n       * @deprecated use `useModelDispatchers` instead.\n       */\n      function useModelActions(name) {\n        if (!warnedUseModelActions) {\n          warnedUseModelActions = true;\n          warning('`useModelActions` API has been detected, please use `useModelDispatchers` instead. \\n\\n\\n Visit https://github.com/ice-lab/icestore/blob/master/docs/upgrade-guidelines.md#usemodelactions to learn about how to upgrade.');\n        }\n        return useModelDispatchers(name);\n      }\n\n      // other apis\n      function getModel(name) {\n        return [getModelState(name), getModelDispatchers(name)];\n      }\n      function getModelState(name) {\n        return store.getState()[name];\n      }\n      function getModelDispatchers(name) {\n        return store.dispatch[name];\n      }\n\n      // class component support\n      function withModel(name, mapModelToProps?) {\n        mapModelToProps = (mapModelToProps || ((model) => ({ [name]: model })));\n        return (Component) => {\n          return (props): React.ReactElement => {\n            const value = useModel(name);\n            const withProps = mapModelToProps(value);\n            return (\n              <Component\n                {...withProps}\n                {...props}\n              />\n            );\n          };\n        };\n      }\n\n      const actionsSuffix = 'Actions';\n      function createWithModelDispatchers(fieldSuffix = 'Dispatchers') {\n        return function withModelDispatchers(name, mapModelDispatchersToProps?) {\n          if (fieldSuffix === actionsSuffix && !warnedWithModelActions) {\n            warnedWithModelActions = true;\n            warning('`withModelActions` API has been detected, please use `withModelDispatchers` instead. \\n\\n\\n Visit https://github.com/ice-lab/icestore/blob/master/docs/upgrade-guidelines.md#withmodelactions to learn about how to upgrade.');\n          }\n          mapModelDispatchersToProps = (mapModelDispatchersToProps || ((dispatch) => ({ [`${name}${fieldSuffix}`]: dispatch })));\n          return (Component) => {\n            return (props): React.ReactElement => {\n              const dispatchers = useModelDispatchers(name);\n              const withProps = mapModelDispatchersToProps(dispatchers);\n              return (\n                <Component\n                  {...withProps}\n                  {...props}\n                />\n              );\n            };\n          };\n        };\n      }\n      const withModelDispatchers = createWithModelDispatchers();\n\n      const actionsStateSuffix = 'ActionsState';\n      function createWithModelEffectsState(fieldSuffix = 'EffectsState') {\n        return function(name, mapModelEffectsStateToProps?) {\n          if (fieldSuffix === actionsStateSuffix && !warnedWithModelActionsState) {\n            warnedWithModelActionsState = true;\n            warning('`withModelActionsState` API has been detected, please use `withModelEffectsState` instead. \\n\\n\\n Visit https://github.com/ice-lab/icestore/blob/master/docs/upgrade-guidelines.md#withmodelactionsstate to learn about how to upgrade.');\n          }\n\n          mapModelEffectsStateToProps = (mapModelEffectsStateToProps || ((effectsState) => ({ [`${name}${fieldSuffix}`]: effectsState })));\n          return (Component) => {\n            return (props): React.ReactElement => {\n              const value = useModelEffectsState(name);\n              const withProps = mapModelEffectsStateToProps(value);\n              return (\n                <Component\n                  {...withProps}\n                  {...props}\n                />\n              );\n            };\n          };\n        };\n      }\n      const withModelEffectsState = createWithModelEffectsState();\n\n      function withModelEffectsError(name, mapModelEffectsErrorToProps?) {\n        mapModelEffectsErrorToProps = (mapModelEffectsErrorToProps || ((errors) => ({ [`${name}EffectsError`]: errors })));\n        return (Component) => {\n          return (props): React.ReactElement => {\n            const value = useModelEffectsError(name);\n            const withProps = mapModelEffectsErrorToProps(value);\n            return (\n              <Component\n                {...withProps}\n                {...props}\n              />\n            );\n          };\n        };\n      }\n\n      function withModelEffectsLoading(name?, mapModelEffectsLoadingToProps?) {\n        mapModelEffectsLoadingToProps = (mapModelEffectsLoadingToProps || ((loadings) => ({ [`${name}EffectsLoading`]: loadings })));\n        return (Component) => {\n          return (props): React.ReactElement => {\n            const value = useModelEffectsLoading(name);\n            const withProps = mapModelEffectsLoadingToProps(value);\n            return (\n              <Component\n                {...withProps}\n                {...props}\n              />\n            );\n          };\n        };\n      }\n\n      function getModelAPIs(name) {\n        return {\n          useValue: () => useModel(name),\n          useState: () => useModelState(name),\n          useDispatchers: () => useModelDispatchers(name),\n          useEffectsState: () => useModelEffectsState(name),\n          useEffectsError: () => useModelEffectsError(name),\n          useEffectsLoading: () => useModelEffectsLoading(name),\n          getValue: () => getModel(name),\n          getState: () => getModelState(name),\n          getDispatchers: () => getModelDispatchers(name),\n          withValue: (mapToProps?) => withModel(name, mapToProps),\n          withDispatchers: (mapToProps?) => withModelDispatchers(name, mapToProps),\n          withEffectsState: (mapToProps?) => withModelEffectsState(name, mapToProps),\n          withEffectsError: (mapToProps?) => withModelEffectsError(name, mapToProps),\n          withEffectsLoading: (mapToProps?) => withModelEffectsLoading(name, mapToProps),\n        };\n      }\n\n      return {\n        getModelAPIs,\n\n        // Hooks\n        useModel,\n        useModelState,\n        useModelDispatchers,\n        useModelEffectsState,\n        useModelEffectsError,\n        useModelEffectsLoading,\n        useModelActions,\n        useModelActionsState,\n\n        // real time\n        getModel,\n        getModelState,\n        getModelDispatchers,\n\n        // Class component support\n        withModel,\n        withModelDispatchers,\n        withModelEffectsState,\n        withModelEffectsError,\n        withModelEffectsLoading,\n        withModelActions: createWithModelDispatchers(actionsSuffix),\n        withModelActionsState: createWithModelEffectsState(actionsStateSuffix),\n      };\n    },\n  };\n};\n"]}